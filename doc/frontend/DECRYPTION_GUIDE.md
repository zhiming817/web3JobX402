# 🔓 简历解密指南

## 两种加密方式的解密方法

### 1️⃣ **简单加密 (Simple Encryption)**

#### 界面提示
```
🔑 需要加密密钥
此简历已使用简单加密保护,请输入密钥以查看内容
```

#### 需要输入什么?
**输入创建简历时生成的加密密钥**

密钥格式示例:
```
b8f3e2c9a1d5f4e6b7a8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0
```

#### 密钥在哪里?

**如果你是简历所有者:**
1. **创建时显示** - 简历创建成功后会弹窗显示密钥
2. **本地存储** - 如果选择保存到本地,系统会自动填充
3. **剪贴板** - 创建时可以复制到剪贴板

**如果你是 HR:**
- 需要简历所有者主动分享密钥给你
- 通常通过邮件、微信等方式发送

#### 解密步骤
```
1. 点击简历卡片的"解锁"按钮
   ↓
2. 在弹出的文本框中粘贴密钥
   ↓
3. 点击"解密"按钮
   ↓
4. 查看完整简历内容
```

#### 注意事项
⚠️ **如果忘记密钥,将永久无法恢复简历内容!**

建议:
- 创建时务必复制并保存密钥
- 可以保存到密码管理器
- 分享给 HR 时使用安全的通讯方式

---

### 2️⃣ **Seal 加密 (Threshold Encryption)**

#### 界面提示
```
🔒 Seal 加密简历
该简历使用 Seal 阈值加密技术保护,访问权限由链上 Allowlist 控制
```

#### 需要输入什么?
**什么都不需要输入!** 完全自动化:

```
✨ Seal 加密特点:
• 无需手动输入密钥
• 系统自动验证您的访问权限
• 只有白名单中的地址才能解密
• 密钥由多个服务器分布式管理
```

#### 解密步骤
```
1. 点击简历卡片的"解锁"按钮
   ↓
2. 点击"🔓 验证权限并解密"按钮
   ↓
3. 系统自动:
   - 创建 SessionKey
   - 验证你是否在 Allowlist 中
   - 从 Seal 服务器获取解密密钥
   - 解密并显示简历
   ↓
4. 查看完整简历内容
```

#### 前提条件
✅ **你的钱包地址必须在该简历的 Allowlist 白名单中**

#### 如何添加到白名单?

**简历所有者操作:**
```
1. 访问 /#/allowlist 页面
2. 使用创建简历时的 Cap ID
3. 添加 HR 的钱包地址
4. 确认交易
```

**代码示例:**
```javascript
await resumeService.addToResumeAllowlist(
  allowlistId,      // Allowlist ID
  capId,            // Cap ID (管理员凭证)
  hrWalletAddress,  // HR 的 Sui 地址
  signAndExecute    // 钱包签名
);
```

#### 可能的错误

**错误 1: "您不在简历的访问白名单中"**
- 原因: 你的地址没有添加到 Allowlist
- 解决: 联系简历所有者添加你的地址

**错误 2: "创建 SessionKey 失败"**
- 原因: 网络问题或 Seal 服务器不可用
- 解决: 稍后重试,或检查网络连接

**错误 3: "Seal 解密失败"**
- 原因: 加密数据损坏或版本不兼容
- 解决: 联系技术支持

---

## 🔍 如何判断是哪种加密?

### 在简历列表中
查看简历卡片底部的标签:

```
🔐 简单加密  ← 简单加密
🔒 Seal 加密  ← Seal 加密
```

### 在解密弹窗中
查看标题栏:

```
🔐 简单加密  ← 需要输入密钥
🔒 Seal 加密保护  ← 自动解密
```

---

## 📊 两种加密方式对比

| 特性 | 简单加密 | Seal 加密 |
|------|---------|-----------|
| **解密方式** | 手动输入密钥 | 自动验证权限 |
| **密钥管理** | 用户自己保管 | 分布式服务器管理 |
| **访问控制** | 密钥=权限 | 链上 Allowlist 控制 |
| **动态管理** | ❌ 无法撤销 | ✅ 可添加/移除 |
| **Gas 费用** | 无 | 有(创建 SessionKey) |
| **安全性** | 中等 | 高 |
| **适用场景** | 个人存储、朋友分享 | 商业场景、付费解锁 |

---

## 💡 用户界面改进

### 简单加密 - 改进后的 UI

**优化点:**
1. ✅ 更清晰的标题: "🔑 需要加密密钥"
2. ✅ 添加了帮助提示框,说明密钥来源
3. ✅ 使用 textarea 代替 input,方便粘贴长密钥
4. ✅ 添加"返回列表"按钮
5. ✅ 改进按钮样式,使用渐变色
6. ✅ 添加底部提示文字

**新增帮助提示:**
```
💡 密钥在哪里?
• 如果你是简历所有者,密钥在创建简历时显示
• 如果你已保存到本地,刷新页面会自动填充
• 如果是 HR,请向简历所有者索取密钥
```

### Seal 加密 - 改进后的 UI

**优化点:**
1. ✅ 更清晰的说明: "该简历使用 Seal 阈值加密技术保护"
2. ✅ 添加特点说明框
3. ✅ 显著的解密按钮: "🔓 验证权限并解密"
4. ✅ 添加操作提示

**新增特点说明:**
```
✨ Seal 加密特点:
• 无需手动输入密钥
• 系统自动验证您的访问权限
• 只有白名单中的地址才能解密
• 密钥由多个服务器分布式管理
```

---

## 🚀 快速开始

### 作为简历所有者

**使用简单加密:**
```
1. 创建简历时不勾选 Seal 选项
2. 完成后复制密钥
3. 分享密钥给需要查看的人
```

**使用 Seal 加密:**
```
1. 先创建 Allowlist (/#/allowlist)
2. 创建简历时勾选 Seal 选项
3. 填入 Allowlist ID 和 Cap ID
4. HR 购买后,添加 HR 地址到白名单
```

### 作为 HR

**查看简单加密的简历:**
```
1. 获得简历所有者提供的密钥
2. 点击"解锁"
3. 粘贴密钥并点击"解密"
```

**查看 Seal 加密的简历:**
```
1. 确认已被添加到白名单
2. 点击"解锁"
3. 点击"验证权限并解密"
4. 自动完成(无需操作)
```

---

## 📝 常见问题

### Q1: 简单加密的密钥丢了怎么办?
**A**: 无法恢复,只能重新创建简历。建议:
- 使用密码管理器保存
- 保存到多个安全位置
- 考虑使用 Seal 加密

### Q2: Seal 加密显示"不在白名单"?
**A**: 联系简历所有者:
1. 提供你的 Sui 钱包地址
2. 等待所有者添加到 Allowlist
3. 刷新页面重试

### Q3: 如何查看我是否在白名单中?
**A**: 
```bash
# 在 Sui Explorer 中查看 Allowlist 对象
https://suiscan.xyz/testnet/object/<ALLOWLIST_ID>

# 查看 list 字段,检查是否包含你的地址
```

### Q4: Seal 解密失败但显示在白名单中?
**A**: 可能原因:
1. Seal 服务器不可用 - 稍后重试
2. 网络问题 - 检查连接
3. SessionKey 未创建成功 - 查看钱包交易记录

### Q5: 可以从简单加密升级到 Seal 加密吗?
**A**: 需要重新创建简历,加密方式创建后无法更改

---

## 🔗 相关文档

- [Allowlist 使用指南](./ALLOWLIST_GUIDE.md)
- [Seal 集成总结](./SEAL_INTEGRATION_SUMMARY.md)
- [简历功能完整指南](./RESUME_FEATURES.md)
- [Walrus + Seal 集成](../../doc/WALRUS_SEAL_INTEGRATION.md)

---

## 📞 技术支持

遇到问题?
- 📧 提交 GitHub Issue
- 💬 加入 Discord 社区
- 📖 查看 [官方文档](https://docs.walrus.site/)
